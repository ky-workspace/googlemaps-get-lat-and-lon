// Generated by CoffeeScript 1.3.3
(function() {

  $.googleMaps = function() {
    this.OPTION = {
      ad: '',
      ido: '',
      keido: '',
      collback: function() {
        return false;
      }
    };
    this.APIOPTION = {
      zoom: 15,
      mapTypeId: google.maps.MapTypeId.ROADMAP,
      scaleControl: true,
      mapTypeControl: false,
      scrollwheel: false
    };
    return this;
  };

  $.googleMaps.prototype = {
    _extends: function(option) {
      return this.OPTION = $.extend(this.OPTION, option);
    },
    _mapCreate: function(domObj) {
      var self;
      self = this;
      $.when(this._mapLatLngObject(this.OPTION.ido, this.OPTION.keido)).always(function(ido, keido) {
        var map;
        self.APIOPTION.center = new google.maps.LatLng(ido, keido);
        self.OPTION.collback(ido, keido);
        map = new google.maps.Map(domObj.get(0), self.APIOPTION);
        self._markerCreate(self.APIOPTION.center, map);
        return this;
      });
      return this;
    },
    _markerCreate: function(latlng, mapObj) {
      var marker, markerOption, self;
      markerOption = {
        'position': latlng,
        'map': mapObj,
        'draggable': true
      };
      marker = new google.maps.Marker(markerOption);
      self = this;
      return google.maps.event.addListener(marker, 'dragend', function() {
        var position;
        position = marker.position;
        mapObj.setCenter(position);
        return self.OPTION.collback(position.lat(), position.lng());
      });
    },
    _mapLatLngObject: function(ido, keido) {
      var $def, geocoder, self;
      $def = $.Deferred();
      self = this;
      if (ido === '' || keido === '') {
        geocoder = new google.maps.Geocoder();
        geocoder.geocode({
          address: self.OPTION.ad
        }, function(results, status) {
          if (status === google.maps.GeocoderStatus.OK) {
            return $def.resolve(results[0].geometry.location.lat(), results[0].geometry.location.lng());
          } else {
            return $def.reject(35.6894875, 139.69170639999993);
          }
        });
      } else {
        $def.resolve(ido, keido);
      }
      return $def.promise();
    }
  };

  $.fn.googleMaps = function(option) {
    var instance;
    instance = new $.googleMaps();
    instance._extends(option);
    return instance._mapCreate(this);
  };

}).call(this);
